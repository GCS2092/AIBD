Parfait ! Voici un **cahier des charges complet et structur√©** pour ta PWA de transport entre Dakar et l‚Äôa√©roport. J‚Äôai int√©gr√© tous les d√©tails que tu as fournis, le workflow, les utilisateurs, la gestion des courses et la stack technique.

---

# **Cahier des charges : PWA de Transport Dakar ‚Üî A√©roport**

## 1Ô∏è‚É£ Contexte du projet

Le projet vise √† d√©velopper une **PWA de r√©servation de transport** entre Dakar et l‚Äôa√©roport, permettant aux clients de r√©server un trajet sans cr√©er de compte. Le syst√®me attribue un chauffeur disponible et notifie le client. La plateforme inclut √©galement une gestion simplifi√©e pour les chauffeurs et l‚Äôadministrateur.

---

## 2Ô∏è‚É£ Objectifs

* Permettre aux clients de r√©server un trajet facilement et rapidement.
* G√©rer les chauffeurs et leur disponibilit√© de mani√®re s√©curis√©e.
* Fournir des notifications en temps r√©el pour les courses (push, WhatsApp, SMS).
* Assurer une administration simple et s√©curis√©e des chauffeurs et des courses.
* Fournir une solution PWA accessible depuis mobile et desktop.
* Suivre les courses en temps r√©el avec g√©olocalisation.
* G√©rer les annulations et remboursements.
* Fournir des analytics et tableaux de bord pour l'administration.

---

## 3Ô∏è‚É£ Utilisateurs

| Type               | Description                     | Informations n√©cessaires                                                                                            | Permissions                                                                                     |
| ------------------ | ------------------------------- | ------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------- |
| **Client**         | Personne qui r√©serve un trajet  | Nom, Pr√©nom, T√©l√©phone, Email (optionnel), Adresse d√©part, Adresse arriv√©e, Date & Heure, Num√©ro de vol (optionnel) | R√©server un trajet, recevoir notifications (push/WhatsApp/SMS), consulter l'√©tat de la course, suivre le chauffeur en temps r√©el, annuler une r√©servation, consulter l'historique, √©valuer le service |
| **Chauffeur**      | Personne effectuant les trajets | Nom, Pr√©nom, T√©l√©phone, Email, Infos v√©hicule (marque, mod√®le, immatriculation), Photo v√©hicule (optionnel), Statut | Accepter/refuser une course, changer disponibilit√©, recevoir notifications push                 |
| **Administrateur** | G√®re la plateforme              | Nom, Pr√©nom, Email, mot de passe                                                                                    | Cr√©er/valider chauffeurs, g√©n√©rer lien d'inscription, suivre courses, modifier infos chauffeurs, consulter dashboard analytics, g√©rer les tarifs, exporter des rapports, g√©rer les annulations |

---

## 4Ô∏è‚É£ Workflow

### **Client**

1. Ouvre la PWA.
2. Choisit trajet (Dakar ‚Üî A√©roport).
3. Consulte les tarifs affich√©s clairement.
4. Remplit ses informations pour le transport (validation en temps r√©el).
5. Confirme r√©servation.
6. Re√ßoit un r√©capitulatif et notification (push/WhatsApp/SMS) de l'attribution du chauffeur.
7. Peut suivre le chauffeur en temps r√©el sur la carte.
8. Re√ßoit des notifications √† chaque √©tape (chauffeur assign√©, en route, arriv√©, termin√©).
9. Peut annuler la r√©servation (selon les conditions).
10. Peut consulter l'historique de ses trajets et √©valuer le service.

### **Chauffeur**

1. Re√ßoit un lien unique d'inscription envoy√© par l'admin.
2. S'inscrit **une seule fois**, renseigne ses informations et celles du v√©hicule.
3. Peut consulter ses courses et accepter/refuser une course.
4. Re√ßoit une notification (push/WhatsApp) lorsqu'une course lui est attribu√©e.
5. D√©lai de r√©ponse : 2 minutes pour accepter/refuser (timeout automatique si pas de r√©ponse).
6. Statut change automatiquement :

   * Disponible ‚Üí peut recevoir des courses (bas√© sur zone de service, horaires, disponibilit√© manuelle).
   * En course ‚Üí a accept√© ou s'est vu attribuer une course.
   * Indisponible ‚Üí ne peut pas recevoir de course.
   * Pause automatique ‚Üí apr√®s X courses cons√©cutives (configurable).
7. Apr√®s la course, statut revient √† Disponible automatiquement.
8. Peut annuler une course avec motif (soumis √† validation admin).

### **Administrateur**

1. G√©n√®re et envoie les liens d'inscription aux chauffeurs.
2. Valide les chauffeurs et leurs informations.
3. Suit toutes les courses et statuts des chauffeurs en temps r√©el.
4. Peut modifier les informations des chauffeurs si n√©cessaire.
5. Consulte le dashboard avec analytics (courses/jour, revenus, chauffeurs actifs, taux d'acceptation).
6. G√®re les tarifs (Dakar‚ÜíA√©roport, A√©roport‚ÜíDakar, tarifs sp√©ciaux).
7. Exporte des rapports (PDF/Excel) pour analyses.
8. G√®re les annulations et remboursements.
9. Configure les param√®tres syst√®me (timeout de r√©ponse, pause automatique, zones de service).
10. Consulte les logs et m√©triques de performance.

---

## 5Ô∏è‚É£ Gestion des courses

### **Tarification**

* Les prix sont **fixes** mais configurables par l'administrateur :
  * Tarif Dakar ‚Üí A√©roport (standard)
  * Tarif A√©roport ‚Üí Dakar (standard)
  * Tarifs sp√©ciaux (heures de pointe, nuit, bagages suppl√©mentaires)
* Affichage clair des tarifs avant confirmation de r√©servation.
* Aucun calcul dynamique bas√© sur la distance.

### **Attribution des courses**

* Les courses sont **attribu√©es aux chauffeurs disponibles** selon :
  * Disponibilit√© (statut = Disponible)
  * Zone de service (g√©olocalisation)
  * Horaires de travail configur√©s
  * Nombre de courses cons√©cutives (√©viter la surcharge)
* Syst√®me de file d'attente avec timeout :
  * Notification au premier chauffeur disponible
  * D√©lai de r√©ponse : 2 minutes (configurable)
  * Si refus ou timeout ‚Üí passage au chauffeur suivant
  * Limite de refus cons√©cutifs par chauffeur (alerte admin si d√©pass√©e)

### **Notifications multi-canaux**

* Notifications en temps r√©el pour :
  * Attribution de course (push + WhatsApp)
  * Confirmation de course (push + WhatsApp + SMS optionnel)
  * Changements de statut du chauffeur (push + WhatsApp)
  * Chauffeur en route (push + WhatsApp)
  * Chauffeur arriv√© (push + WhatsApp)
  * Course termin√©e (push + WhatsApp)
* Canaux de notification :
  * **Firebase Cloud Messaging** (push notifications)
  * **WhatsApp Business API** (confirmations et notifications importantes)
  * **SMS** (fallback si push/WhatsApp √©chouent, optionnel)

### **Gestion des annulations**

* **Annulation c√¥t√© client** :
  * Possible jusqu'√† X heures avant la course (configurable)
  * Remboursement selon conditions (configurable)
  * Notification au chauffeur et admin
* **Annulation c√¥t√© chauffeur** :
  * N√©cessite un motif (obligatoire)
  * Notification automatique au client
  * R√©attribution automatique √† un autre chauffeur
  * Alerte admin si annulation fr√©quente
* **Annulation c√¥t√© admin** :
  * Possible √† tout moment
  * Notification client et chauffeur
  * Remboursement automatique si applicable

**Diagramme simplifi√© d'attribution :**

```
Client r√©serve ‚Üí Backend cherche chauffeur disponible (zone + disponibilit√©)
  ‚Üí Notification (push + WhatsApp) au chauffeur
  ‚Üí Timeout 2 min : Chauffeur accepte/refuse
    ‚Üí Si accept√© : Course attribu√©e ‚Üí Statut = En course ‚Üí Notification client (push + WhatsApp)
    ‚Üí Si refus√©/timeout : Passage au chauffeur suivant
  ‚Üí Chauffeur termine course ‚Üí Statut = Disponible
  ‚Üí Pause automatique si X courses cons√©cutives
```

---

## 6Ô∏è‚É£ Fonctionnalit√©s principales

### **Frontend**

* Formulaire r√©servation sans cr√©ation de compte avec validation en temps r√©el.
* Affichage carte pour trajet (Leaflet/Mapbox) avec suivi GPS en temps r√©el.
* Affichage clair des tarifs avant r√©servation.
* Page de suivi de course avec statuts (attente chauffeur, en route, arriv√©, termin√©).
* Notifications push (Firebase Cloud Messaging).
* Gestion du cache et des appels API (TanStack Query + Axios).
* Navigation PWA (React Router).
* Mode offline pour consulter les r√©servations (Service Worker).
* Historique des trajets avec √©valuation.
* Interface multilingue (Fran√ßais, Wolof, Anglais).
* Pagination et lazy loading pour optimiser les performances.

### **Backend**

* Gestion des utilisateurs et r√¥les (NestJS).
* API REST/GraphQL pour r√©servation et suivi des courses.
* Attribution automatique des chauffeurs disponibles avec file d'attente et timeout.
* Gestion des statuts des chauffeurs (disponible, en course, indisponible, pause auto).
* Validation renforc√©e des informations (t√©l√©phone format S√©n√©gal, email, adresses).
* Notifications multi-canaux en temps r√©el :
  * WebSocket pour mises √† jour instantan√©es
  * Firebase Cloud Messaging (push)
  * WhatsApp Business API (confirmations)
  * SMS (fallback via Twilio ou API locale)
* Gestion des annulations (client, chauffeur, admin) avec remboursements.
* Rate limiting pour √©viter les abus.
* Logs et monitoring (erreurs, performances, m√©triques).
* G√©olocalisation et suivi GPS en temps r√©el.
* Gestion des zones de service et horaires de travail.
* Syst√®me de pause automatique apr√®s X courses.

### **Base de donn√©es**

* PostgreSQL / Supabase : tables pour :
  * Clients (r√©servations, historique)
  * Chauffeurs (infos, statuts, zones, horaires)
  * V√©hicules (infos, photos)
  * Courses (d√©tails, statuts, g√©olocalisation, historique)
  * Notifications (logs des envois)
  * Tarifs (configuration)
  * Annulations (motifs, remboursements)
  * √âvaluations (notes, commentaires)
* Support g√©olocalisation (PostGIS pour zones de service et suivi GPS).
* Indexation optimis√©e pour requ√™tes fr√©quentes.
* Cache Redis pour am√©liorer les performances (optionnel).

---

## 7Ô∏è‚É£ Architecture technique

| Couche          | Technologie                                                        | Objectif                                          |
| --------------- | ------------------------------------------------------------------ | ------------------------------------------------- |
| Frontend        | React, React Router                                                | PWA, navigation fluide                            |
| Cartographie    | Leaflet / Mapbox                                                   | Trajets et g√©olocalisation                        |
| State/Data      | Axios, TanStack Query                                              | Appels API et cache                               |
| Notifications   | Firebase Messaging, WhatsApp Business API, SMS (Twilio/API locale) | Notifications push, WhatsApp, SMS (fallback)      |
| Backend         | Node.js + NestJS                                                   | API REST/GraphQL, WebSocket, gestion utilisateurs |
| Base de donn√©es | PostgreSQL / Supabase                                              | Gestion relations et g√©olocalisation              |
| D√©ploiement     | Vercel / Netlify (frontend), Render / Supabase Functions (backend) | H√©bergement simple et performant                  |

---

## 8Ô∏è‚É£ S√©curit√©

* Lien d'inscription unique pour chaque chauffeur (emp√™che inscription publique).
* Modification des informations chauffeur uniquement par admin.
* HTTPS obligatoire pour toutes les communications.
* Validation renforc√©e des entr√©es c√¥t√© frontend et backend :
  * Format t√©l√©phone S√©n√©gal (+221)
  * Validation email stricte
  * Validation adresses
  * Sanitization des donn√©es
* Rate limiting sur les endpoints critiques (r√©servations, authentification).
* Authentification JWT s√©curis√©e pour admin et chauffeurs.
* Logs d'audit pour toutes les actions sensibles.
* Protection CSRF et XSS.
* Chiffrement des donn√©es sensibles en base.
* Gestion s√©curis√©e des tokens WhatsApp et API keys.

---

## 9Ô∏è‚É£ D√©ploiement

* **Frontend** : Vercel ou Netlify (PWA avec Service Worker).
* **Backend** : Render ou Supabase Functions (Node/NestJS).
* **Base de donn√©es** : Supabase (PostgreSQL avec plan gratuit possible).
* **Cache** : Redis (optionnel, pour am√©liorer les performances).
* **Monitoring** : Sentry ou similaire pour le suivi des erreurs.

---

## üîü Fonctionnalit√©s avanc√©es

### **Dashboard Administrateur**

* **Analytics en temps r√©el** :
  * Nombre de courses par jour/semaine/mois
  * Revenus totaux et par p√©riode
  * Nombre de chauffeurs actifs
  * Taux d'acceptation/refus des courses
  * Temps moyen de r√©ponse des chauffeurs
  * Taux d'annulation
  * Satisfaction client (notes moyennes)
* **Gestion des tarifs** :
  * Configuration des tarifs par trajet
  * Tarifs sp√©ciaux (heures de pointe, nuit)
  * Historique des modifications de tarifs
* **Rapports exportables** :
  * Export PDF/Excel des courses
  * Rapports financiers
  * Statistiques des chauffeurs
  * Analyses de performance

### **Exp√©rience Client**

* **Suivi en temps r√©el** :
  * Carte interactive avec position du chauffeur
  * Estimation du temps d'arriv√©e
  * Statuts visuels (attente, en route, arriv√©)
* **Historique et √©valuation** :
  * Liste de toutes les courses pass√©es
  * Syst√®me d'√©valuation (1-5 √©toiles + commentaire)
  * Favoris (chauffeurs pr√©f√©r√©s)
* **Notifications personnalis√©es** :
  * Pr√©f√©rences de canal (push, WhatsApp, SMS)
  * Rappels avant la course
  * Confirmations automatiques

### **Optimisations et Performance**

* **Cache intelligent** :
  * Cache des trajets fr√©quents
  * Cache des donn√©es chauffeurs
  * Invalidation automatique du cache
* **Optimisations** :
  * Pagination pour toutes les listes
  * Lazy loading des images
  * Compression des assets
  * Service Worker pour mode offline
* **Scalabilit√©** :
  * Architecture pr√™te pour la mont√©e en charge
  * Load balancing (si n√©cessaire)
  * Base de donn√©es optimis√©e avec index

### **Tests et Qualit√©**

* Tests unitaires pour les fonctions critiques
* Tests d'int√©gration pour les workflows
* Tests de performance (load testing)
* Tests de s√©curit√© (penetration testing)

---

## 1Ô∏è‚É£1Ô∏è‚É£ Support multilingue

* **Langues support√©es** :
  * Fran√ßais (par d√©faut)
  * Wolof
  * Anglais
* **Localisation** :
  * Interface utilisateur traduite
  * Notifications dans la langue pr√©f√©r√©e
  * Format de dates/heures localis√©
  * Format mon√©taire (FCFA)

---

## 1Ô∏è‚É£2Ô∏è‚É£ Roadmap future (am√©liorations possibles)

* Application mobile native (iOS/Android)
* Paiement en ligne int√©gr√©
* Syst√®me de fid√©lit√© et points
* R√©servation r√©currente (abonnements)
* Partage de trajet (covoiturage)
* Int√©gration avec syst√®mes de r√©servation d'h√¥tels
* Chat en direct client-chauffeur
* Syst√®me de badges pour chauffeurs (qualit√©, ponctualit√©)

---

 
